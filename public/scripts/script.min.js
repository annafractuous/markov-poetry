"use strict";var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function o(a,r,u){function c(e,t){if(!r[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var s=r[e]={exports:{}};a[e][0].call(s.exports,function(t){return c(a[e][1][t]||t)},s,s.exports,o,a,r,u)}return r[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)c(u[t]);return c}({1:[function(t,v,e){(function(t){var y="Expected a function",n=NaN,i="[object Symbol]",s=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,r=/^0o[0-7]+$/i,u=parseInt,e="object"==(void 0===t?"undefined":_typeof(t))&&t&&t.Object===Object&&t,c="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self&&self.Object===Object&&self,l=e||c||Function("return this")(),h=Object.prototype.toString,b=Math.max,k=Math.min,L=function(){return l.Date.now()};function d(n,s,t){var o,a,r,u,c,l,h=0,d=!1,f=!1,e=!0;if("function"!=typeof n)throw new TypeError(y);function v(t){var e=o,i=a;return o=a=void 0,h=t,u=n.apply(i,e)}function m(t){var e=t-l;return void 0===l||s<=e||e<0||f&&r<=t-h}function g(){var t,e,i=L();if(m(i))return p(i);c=setTimeout(g,(e=s-((t=i)-l),f?k(e,r-(t-h)):e))}function p(t){return c=void 0,e&&o?v(t):(o=a=void 0,u)}function i(){var t,e=L(),i=m(e);if(o=arguments,a=this,l=e,i){if(void 0===c)return h=t=l,c=setTimeout(g,s),d?v(t):u;if(f)return c=setTimeout(g,s),v(l)}return void 0===c&&(c=setTimeout(g,s)),u}return s=E(s)||0,B(t)&&(d=!!t.leading,r=(f="maxWait"in t)?b(E(t.maxWait)||0,s):r,e="trailing"in t?!!t.trailing:e),i.cancel=function(){void 0!==c&&clearTimeout(c),o=l=a=c=void(h=0)},i.flush=function(){return void 0===c?u:p(L())},i}function B(t){var e=void 0===t?"undefined":_typeof(t);return!!t&&("object"==e||"function"==e)}function f(t){return"symbol"==(void 0===t?"undefined":_typeof(t))||!!(e=t)&&"object"==(void 0===e?"undefined":_typeof(e))&&h.call(t)==i;var e}function E(t){if("number"==typeof t)return t;if(f(t))return n;if(B(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=B(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(s,"");var i=a.test(t);return i||r.test(t)?u(t.slice(2),i?2:8):o.test(t)?n:+t}v.exports=function(t,e,i){var n=!0,s=!0;if("function"!=typeof t)throw new TypeError(y);return B(i)&&(n="leading"in i?!!i.leading:n,s="trailing"in i?!!i.trailing:s),d(t,e,{leading:n,maxWait:e,trailing:s})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){throttle=t("lodash.throttle");var n=function(){function t(){_classCallCheck(this,t),this.saveSelectors(),this.saveListenerCallbacks(),this.addListeners(),this.dictionary=dictionary,this.dictionaryKeys=Object.keys(this.dictionary),this.defaultText=this.composition.innerText,this.firstWord=!0,this.dbInitialized=!1,this.museumLoaded=!1,this.poemsPerPage=20,console.log(dictionary)}return _createClass(t,[{key:"saveSelectors",value:function(){this.activePage=document.querySelector(".active-page"),this.activeNav=document.querySelector(".active-nav-item"),this.suggestionEls=document.getElementsByClassName("suggestion-field"),this.composition=document.getElementById("composition-field"),this.input=document.getElementById("initial-input"),this.startBtn=this.suggestionEls[1],this.restartBtn=document.getElementById("restart-btn"),this.backBtn=document.getElementById("back-btn"),this.saveBtn=document.getElementById("save-btn"),this.shareBtn=document.getElementById("share-btn"),this.fbBtn=document.getElementById("share-fb-btn"),this.twitterBtn=document.getElementById("share-twitter-btn"),this.shareBtns=document.getElementById("share-btns"),this.dbSaveBtn=document.getElementById("db-save-btn"),this.museumEntries=document.getElementById("museum-entries")}},{key:"saveListenerCallbacks",value:function(){var e=this;this.startCallback=function(){return e.start()},this.selectionCallback=function(t){return e.updateComposition(t)},this.museumScrollCallback=throttle(function(){return e.museumLoadMore()},1e3)}},{key:"addListeners",value:function(){this.overlayListener(),this.navListener(),this.activeListener(),this.inactiveListener(),this.typingListener(),this.startListener(!0),this.backspaceListener(),this.buttonListeners()}},{key:"overlayListener",value:function(){var t=this;document.querySelector(".save-poem-overlay").addEventListener("click",function(){return t.toggleSaveDialogue()})}},{key:"navListener",value:function(){var e=this;document.querySelectorAll(".nav-list-item").forEach(function(t){t.addEventListener("click",function(t){return e.clickNavItem(t)})})}},{key:"activeListener",value:function(){var t=this;this.input.addEventListener("click",function(){return t.clearDefaultText()})}},{key:"inactiveListener",value:function(){var e=this;window.addEventListener("click",function(t){return e.replaceDefaultText(t)})}},{key:"typingListener",value:function(){var e=this;this.input.addEventListener("input",function(t){return e.type(t)})}},{key:"startListener",value:function(t){t?this.startBtn.addEventListener("click",this.startCallback):this.startBtn.removeEventListener("click",this.startCallback)}},{key:"backspaceListener",value:function(){var e=this;window.addEventListener("keyup",function(t){8!==t.keyCode||e.firstWord||e.deleteLastWord()})}},{key:"selectionListener",value:function(t){var e=this;t?[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(t){t.addEventListener("click",e.selectionCallback)}):[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(t){t.removeEventListener("click",e.selectionCallback)})}},{key:"scrollListener",value:function(t){t?window.addEventListener("scroll",this.museumScrollCallback):window.removeEventListener("scroll",this.museumScrollCallback)}},{key:"buttonListeners",value:function(){var t=this;this.restartBtn.addEventListener("click",function(){return t.restartComposition()}),this.backBtn.addEventListener("click",function(){return t.deleteLastWord()}),this.saveBtn.addEventListener("click",function(){return t.toggleSaveDialogue()}),this.shareBtn.addEventListener("click",function(){return t.toggleShareButtons()}),this.fbBtn.addEventListener("click",function(){return t.shareToFB()}),this.twitterBtn.addEventListener("click",function(){return t.shareToTwitter()}),this.dbSaveBtn.addEventListener("click",function(){return t.savePoem()})}},{key:"clickNavItem",value:function(t){var e=t.currentTarget.dataset.page,i=document.getElementById(e);i!==this.activePage&&(this.museumLoaded||"museum-page"!==i.id||this.loadMuseum(),this.navigate(i),this.updateActiveNav(e))}},{key:"navigate",value:function(t){var e=this;this.activePage.classList.add("slide-out"),t.classList.add("slide-in"),setTimeout(function(){e.activePage.classList.remove("active-page"),e.activePage.classList.remove("slide-out"),t.classList.add("active-page"),t.classList.remove("slide-in"),e.activePage=t},300)}},{key:"updateActiveNav",value:function(t){var e=document.querySelector("[data-page="+t);this.activeNav.classList.remove("active-nav-item"),e.classList.add("active-nav-item"),this.activeNav=e}},{key:"type",value:function(t){var e=void 0;e=(e=(e=t.target.value).split(" ")[0]).trim().toLowerCase(),this.composition.innerText=e,this.showStart(!!e.length)}},{key:"showStart",value:function(t){t?this.startBtn.classList.add("start-btn"):this.startBtn.classList.remove("start-btn")}},{key:"start",value:function(){this.showStart(!1),this.startListener(!1),this.selectionListener(!0),this.disableInput(),this.readInput()}},{key:"readInput",value:function(){var t=this.composition.innerText;this.showSuggestions(t),this.toggleButtonsState(!0)}},{key:"disableInput",value:function(){this.input.disabled=!0,this.firstWord=!1}},{key:"enableInput",value:function(){this.input.disabled=!1,this.input.value="",this.input.focus(),this.firstWord=!0}},{key:"updateComposition",value:function(t){var e=t.target.innerText;e&&(this.addNextWord(e),this.showSuggestions(e))}},{key:"addNextWord",value:function(t){this.composition.innerText+=" "+t}},{key:"deleteLastWord",value:function(){var t=this.composition.innerText.split(" ");t.pop(),t.length?(this.composition.innerText=t.join(" "),this.refreshSuggestions()):this.restartComposition()}},{key:"getLastWord",value:function(){var t=this.composition.innerText.split(" ");return t[t.length-1]}},{key:"restartComposition",value:function(){this.composition.innerText="",this.enableInput(),this.clearSuggestions(),this.toggleButtonsState(!1),this.startListener(!0)}},{key:"showSuggestions",value:function(t){var e=this.getSuggestions(t);this.returnSuggestions(e)}},{key:"getSuggestions",value:function(t){var e=this.dictionary[t],i=this.makeUnique(e),n=[];if(i.length<3){var s=3-i.length,o=this.getDefaults(s);n=[].concat(_toConsumableArray(i),_toConsumableArray(o))}else if(3===i.length)n=i;else for(;n.length<3;){var a=this.getRandomEl(e);n.includes(a)||n.push(a)}return n}},{key:"getDefaults",value:function(t){return this.getSuggestions("the").slice(0,t)}},{key:"returnSuggestions",value:function(t){for(var e=0;e<3;e++)this.suggestionEls[e].innerText=t[e]}},{key:"refreshSuggestions",value:function(){var t=this.getLastWord();this.showSuggestions(t)}},{key:"clearSuggestions",value:function(){[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(t){t.innerText=""})}},{key:"loadMuseum",value:function(){this.dbInitialized||this.initializeFirebase(),this.fetchPoems(!0),this.scrollListener(!0),this.museumLoaded=!0}},{key:"initializeFirebase",value:function(){this.db=firebase.database(),this.poemsDB=this.db.ref("poems"),this.dbInitialized=!0}},{key:"fetchPoems",value:function(e){var i=this;(e?this.poemsDB:this.poemsDB.orderByKey().endAt(this.lastPoem)).limitToLast(this.poemsPerPage+1).on("value",function(t){i.processPoems(t.val(),e)},function(t){console.log("The read failed: ",t)})}},{key:"processPoems",value:function(t){var e=Object.keys(t),i=e.length<this.poemsPerPage,n=i?Object.values(t):Object.values(t).slice(1);i&&this.scrollListener(!1),this.lastPoem=e[0],this.displayPoems(n)}},{key:"displayPoems",value:function(t){var e=this;(t=t.reverse()).forEach(function(t){return e.displayPoem(t)})}},{key:"displayPoem",value:function(t){var e='\n            <div class="museum-entry">\n                <p class="poem-text">'+t.poem+'</p>\n                <p class="poem-composer">'+t.user+"</p>\n            </div>\n        ";this.museumEntries.innerHTML+=e}},{key:"museumLoadMore",value:function(){"museum-page"===this.activePage.id&&(this.museumEntries.getBoundingClientRect().bottom-window.innerHeight<=window.innerHeight&&this.fetchPoems())}},{key:"savePoem",value:function(){var t=this.composition.innerText,e=document.getElementById("penname").value;this.dbInitialized||this.initializeFirebase(),this.savePoemToDB(t,e),this.toggleSaveDialogue()}},{key:"savePoemToDB",value:function(t,e){var i={};i[this.poemsDB.push().key]={poem:t,user:e},this.poemsDB.update(i)}},{key:"toggleButtonsState",value:function(e){[this.restartBtn,this.backBtn,this.saveBtn,this.shareBtn].forEach(function(t){e?t.classList.remove("disabled"):t.classList.add("disabled")})}},{key:"toggleSaveDialogue",value:function(){document.body.classList.toggle("dialogue-open")}},{key:"toggleShareButtons",value:function(){this.shareBtns.classList.toggle("expanded")}},{key:"clearDefaultText",value:function(){""==this.input.value&&(this.composition.innerText="")}},{key:"replaceDefaultText",value:function(t){"initial-input"!==t.target.id&&""==this.input.value&&(this.composition.innerText=this.defaultText)}},{key:"shareToFB",value:function(){var t=encodeURI(this.composition.innerText);window.open("https://www.facebook.com/dialog/share?app_id=344145906430055&display=popup&href=https%3A%2F%2Fmusemachina.com&quote="+t,"_blank"),this.toggleShareButtons()}},{key:"shareToTwitter",value:function(){var t='"'+this.composition.innerText+'" | composing computer poetry at https://musemachina.com',e=encodeURI(t);window.open("https://twitter.com/intent/tweet?text="+e,"_blank"),this.toggleShareButtons()}},{key:"makeUnique",value:function(t){return[].concat(_toConsumableArray(new Set(t)))}},{key:"getRandomEl",value:function(t){return t[Math.floor(Math.random()*t.length)]}}]),t}();document.addEventListener("DOMContentLoaded",function(){MuseMachina=new n})},{"lodash.throttle":1}]},{},[2]);