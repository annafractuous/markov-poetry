"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var App=function(){function e(){_classCallCheck(this,e),this.saveSelectors(),this.addListeners(),this.dictionary=dictionary,this.dictionaryKeys=Object.keys(this.dictionary),this.defaultText=this.composition.innerText,this.firstWord=!0,console.log(dictionary)}return _createClass(e,[{key:"saveSelectors",value:function(){this.activePage=document.querySelector(".active-page"),this.activeNav=document.querySelector(".active-nav-item"),this.museumEntries=document.getElementsByClassName("musem-entries"),this.suggestionEls=document.getElementsByClassName("suggestion-field"),this.composition=document.getElementById("composition-field"),this.input=document.getElementById("initial-input"),this.restartBtn=document.getElementById("restart-btn"),this.backBtn=document.getElementById("back-btn")}},{key:"addListeners",value:function(){this.navListener(),this.activeListener(),this.inactiveListener(),this.typingListener(),this.backspaceListener(),this.selectionListener(),this.buttonListeners()}},{key:"navListener",value:function(){var t=this;document.querySelectorAll(".nav-list-item").forEach(function(e){e.addEventListener("click",function(e){return t.clickNavItem(e)})})}},{key:"activeListener",value:function(){var e=this;this.input.addEventListener("click",function(){return e.clearDefaultText()})}},{key:"inactiveListener",value:function(){var t=this;window.addEventListener("click",function(e){return t.replaceDefaultText(e)})}},{key:"typingListener",value:function(){var t=this;this.input.addEventListener("input",function(e){return t.readInput(e)})}},{key:"backspaceListener",value:function(){var t=this;window.addEventListener("keyup",function(e){8!==e.keyCode||t.firstWord||t.deleteLastWord()})}},{key:"selectionListener",value:function(){var t=this;[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(e){e.addEventListener("click",function(e){return t.updateComposition(e)})})}},{key:"buttonListeners",value:function(){var e=this;this.restartBtn.addEventListener("click",function(){return e.restartComposition()}),this.backBtn.addEventListener("click",function(){return e.deleteLastWord()})}},{key:"clickNavItem",value:function(e){var t=e.currentTarget.dataset.page,i=document.getElementById(t);i!==this.activePage&&(this.navigate(i),this.updateActiveNav(t))}},{key:"navigate",value:function(e){var t=this;this.activePage.classList.add("slide-out"),e.classList.add("slide-in"),setTimeout(function(){t.activePage.classList.remove("active-page"),t.activePage.classList.remove("slide-out"),e.classList.add("active-page"),e.classList.remove("slide-in"),t.activePage=e},300)}},{key:"updateActiveNav",value:function(e){var t=document.querySelector("[data-page="+e);this.activeNav.classList.remove("active-nav-item"),t.classList.add("active-nav-item"),this.activeNav=t}},{key:"readInput",value:function(e){var t=void 0;t=(t=(t=e.target.value).split(" ")[0]).trim().toLowerCase(),this.composition.innerText=t,this.getSuggestions(t);var i=!t.length;this.toggleButtonsState(i)}},{key:"disableInput",value:function(){this.input.disabled=!0,this.firstWord=!1}},{key:"enableInput",value:function(){this.input.disabled=!1,this.input.value="",this.input.focus(),this.firstWord=!0}},{key:"updateComposition",value:function(e){var t=e.target.innerText;t&&(this.addNextWord(t),this.getSuggestions(t),this.firstWord&&this.disableInput())}},{key:"addNextWord",value:function(e){this.composition.innerText+=" "+e}},{key:"deleteLastWord",value:function(){var e=this.composition.innerText.split(" ");e.pop(),e.length?(this.composition.innerText=e.join(" "),this.refreshSuggestions()):this.restartComposition()}},{key:"getLastWord",value:function(){var e=this.composition.innerText.split(" ");return e[e.length-1]}},{key:"restartComposition",value:function(){this.composition.innerText="",this.enableInput(),this.clearSuggestions(),this.toggleButtonsState(!0)}},{key:"getSuggestions",value:function(e){var t=this.dictionary[e],i=[];if(t){var n=this.makeUnique(t);if(n.length<=3)i=n;else for(;i.length<3;){var s=this.getRandomEl(t);i.includes(s)||i.push(s)}}this.returnSuggestions(i)}},{key:"returnSuggestions",value:function(e){for(var t=0;t<3;t++)e[t]?this.suggestionEls[t].innerText=e[t]:this.suggestionEls[t].innerText=""}},{key:"refreshSuggestions",value:function(){var e=this.getLastWord();this.getSuggestions(e)}},{key:"clearSuggestions",value:function(){[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(e){e.innerText=""})}},{key:"loadMuseum",value:function(){this.initializeFirebase(),this.fetchPoems()}},{key:"initializeFirebase",value:function(){this.db=firebase.database(),this.poemsDB=this.db.ref("poems")}},{key:"fetchPoems",value:function(){var t=this;this.poemsDB.limitToLast(20).on("value",function(e){t.displayPoems(e.val())},function(e){console.log("The read failed: ",e)})}},{key:"displayPoems",value:function(e){var t=this;(e=Object.values(e).reverse()).forEach(function(e){return t.displayPoem(e)})}},{key:"displayPoem",value:function(e){var t='\n            <div class="museum-entry">\n                <p class="poem-text">'+e.poem+'</p>\n                <p class="poem-composer">'+e.user+"</p>\n            </div>\n        ";this.museumEntries.innerHTML+=t}},{key:"savePoem",value:function(e,t){var i={};i[this.poemsDB.push().key]={poem:e,user:t},this.poemsDB.update(i)}},{key:"toggleButtonsState",value:function(t){[this.restartBtn,this.backBtn].forEach(function(e){t?e.classList.add("disabled"):e.classList.remove("disabled")})}},{key:"clearDefaultText",value:function(){""==this.input.value&&(this.composition.innerText="")}},{key:"replaceDefaultText",value:function(e){"initial-input"!==e.target.id&&""==this.input.value&&(this.composition.innerText=this.defaultText)}},{key:"makeUnique",value:function(e){return[].concat(_toConsumableArray(new Set(e)))}},{key:"getRandomEl",value:function(e){return e[Math.floor(Math.random()*e.length)]}}]),e}();document.addEventListener("DOMContentLoaded",function(){MuseMachina=new App});