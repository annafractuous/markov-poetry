"use strict";var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var App=function(){function t(){_classCallCheck(this,t),this.saveSelectors(),this.saveListenerCallbacks(),this.addListeners(),this.dictionary=dictionary,this.dictionaryKeys=Object.keys(this.dictionary),this.defaultText=this.composition.innerText,this.firstWord=!0,this.dbInitialized=!1,this.museumLoaded=!1,console.log(dictionary)}return _createClass(t,[{key:"saveSelectors",value:function(){this.activePage=document.querySelector(".active-page"),this.activeNav=document.querySelector(".active-nav-item"),this.suggestionEls=document.getElementsByClassName("suggestion-field"),this.composition=document.getElementById("composition-field"),this.input=document.getElementById("initial-input"),this.startBtn=this.suggestionEls[1],this.restartBtn=document.getElementById("restart-btn"),this.backBtn=document.getElementById("back-btn"),this.saveBtn=document.getElementById("save-btn"),this.shareBtn=document.getElementById("share-btn"),this.dbSaveBtn=document.getElementById("db-save-btn"),this.museumEntries=document.getElementById("musem-entries")}},{key:"saveListenerCallbacks",value:function(){var e=this;this.startCallback=function(){return e.start()},this.selectionCallback=function(t){return e.updateComposition(t)}}},{key:"addListeners",value:function(){this.overlayListener(),this.navListener(),this.activeListener(),this.inactiveListener(),this.typingListener(),this.startListener(!0),this.backspaceListener(),this.buttonListeners()}},{key:"overlayListener",value:function(){var t=this;document.querySelector(".save-poem-overlay").addEventListener("click",function(){return t.toggleSaveDialogue(!1)})}},{key:"navListener",value:function(){var e=this;document.querySelectorAll(".nav-list-item").forEach(function(t){t.addEventListener("click",function(t){return e.clickNavItem(t)})})}},{key:"activeListener",value:function(){var t=this;this.input.addEventListener("click",function(){return t.clearDefaultText()})}},{key:"inactiveListener",value:function(){var e=this;window.addEventListener("click",function(t){return e.replaceDefaultText(t)})}},{key:"typingListener",value:function(){var e=this;this.input.addEventListener("input",function(t){return e.type(t)})}},{key:"startListener",value:function(t){t?this.startBtn.addEventListener("click",this.startCallback):this.startBtn.removeEventListener("click",this.startCallback)}},{key:"backspaceListener",value:function(){var e=this;window.addEventListener("keyup",function(t){8!==t.keyCode||e.firstWord||e.deleteLastWord()})}},{key:"selectionListener",value:function(t){var e=this;t?[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(t){t.addEventListener("click",e.selectionCallback)}):[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(t){t.removeEventListener("click",e.selectionCallback)})}},{key:"buttonListeners",value:function(){var t=this;this.restartBtn.addEventListener("click",function(){return t.restartComposition()}),this.backBtn.addEventListener("click",function(){return t.deleteLastWord()}),this.saveBtn.addEventListener("click",function(){return t.toggleSaveDialogue(!0)}),this.dbSaveBtn.addEventListener("click",function(){return t.savePoem()})}},{key:"clickNavItem",value:function(t){var e=t.currentTarget.dataset.page,i=document.getElementById(e);i!==this.activePage&&(this.museumLoaded||"museum-page"!==i.id||this.loadMuseum(),this.navigate(i),this.updateActiveNav(e))}},{key:"navigate",value:function(t){var e=this;this.activePage.classList.add("slide-out"),t.classList.add("slide-in"),setTimeout(function(){e.activePage.classList.remove("active-page"),e.activePage.classList.remove("slide-out"),t.classList.add("active-page"),t.classList.remove("slide-in"),e.activePage=t},300)}},{key:"updateActiveNav",value:function(t){var e=document.querySelector("[data-page="+t);this.activeNav.classList.remove("active-nav-item"),e.classList.add("active-nav-item"),this.activeNav=e}},{key:"type",value:function(t){var e=void 0;e=(e=(e=t.target.value).split(" ")[0]).trim().toLowerCase(),this.composition.innerText=e,this.showStart(!!e.length)}},{key:"showStart",value:function(t){t?this.startBtn.classList.add("start-btn"):this.startBtn.classList.remove("start-btn")}},{key:"start",value:function(){this.showStart(!1),this.startListener(!1),this.selectionListener(!0),this.disableInput(),this.readInput()}},{key:"readInput",value:function(){var t=this.composition.innerText;this.showSuggestions(t),this.toggleButtonsState(!0)}},{key:"disableInput",value:function(){this.input.disabled=!0,this.firstWord=!1}},{key:"enableInput",value:function(){this.input.disabled=!1,this.input.value="",this.input.focus(),this.firstWord=!0}},{key:"updateComposition",value:function(t){var e=t.target.innerText;e&&(this.addNextWord(e),this.showSuggestions(e))}},{key:"addNextWord",value:function(t){this.composition.innerText+=" "+t}},{key:"deleteLastWord",value:function(){var t=this.composition.innerText.split(" ");t.pop(),t.length?(this.composition.innerText=t.join(" "),this.refreshSuggestions()):this.restartComposition()}},{key:"getLastWord",value:function(){var t=this.composition.innerText.split(" ");return t[t.length-1]}},{key:"restartComposition",value:function(){this.composition.innerText="",this.enableInput(),this.clearSuggestions(),this.toggleButtonsState(!1),this.startListener(!0)}},{key:"showSuggestions",value:function(t){var e=this.getSuggestions(t);this.returnSuggestions(e)}},{key:"getSuggestions",value:function(t){var e=this.dictionary[t],i=this.makeUnique(e),n=[];if(i.length<3){var s=3-i.length,a=this.getDefaults(s);n=[].concat(_toConsumableArray(i),_toConsumableArray(a))}else if(3===i.length)n=i;else for(;n.length<3;){var o=this.getRandomEl(e);n.includes(o)||n.push(o)}return n}},{key:"getDefaults",value:function(t){return this.getSuggestions("the").slice(0,t)}},{key:"returnSuggestions",value:function(t){for(var e=0;e<3;e++)this.suggestionEls[e].innerText=t[e]}},{key:"refreshSuggestions",value:function(){var t=this.getLastWord();this.showSuggestions(t)}},{key:"clearSuggestions",value:function(){[].concat(_toConsumableArray(this.suggestionEls)).forEach(function(t){t.innerText=""})}},{key:"loadMuseum",value:function(){this.dbInitialized||this.initializeFirebase(),this.fetchPoems(),this.museumLoaded=!0}},{key:"initializeFirebase",value:function(){this.db=firebase.database(),this.poemsDB=this.db.ref("poems"),this.dbInitialized=!0}},{key:"fetchPoems",value:function(){var e=this;this.poemsDB.limitToLast(20).on("value",function(t){e.displayPoems(t.val())},function(t){console.log("The read failed: ",t)})}},{key:"displayPoems",value:function(t){var e=this;(t=Object.values(t).reverse()).forEach(function(t){return e.displayPoem(t)})}},{key:"displayPoem",value:function(t){var e='\n            <div class="museum-entry">\n                <p class="poem-text">'+t.poem+'</p>\n                <p class="poem-composer">'+t.user+"</p>\n            </div>\n        ";this.museumEntries.innerHTML+=e}},{key:"savePoem",value:function(){var t=this.composition.innerText,e=document.getElementById("penname").value;this.dbInitialized||this.initializeFirebase(),this.savePoemToDB(t,e),this.toggleSaveDialogue(!1)}},{key:"savePoemToDB",value:function(t,e){var i={};i[this.poemsDB.push().key]={poem:t,user:e},this.poemsDB.update(i)}},{key:"toggleSaveDialogue",value:function(t){var e=document.body;t?e.classList.add("dialogue-open"):e.classList.remove("dialogue-open")}},{key:"toggleButtonsState",value:function(e){[this.restartBtn,this.backBtn,this.saveBtn,this.shareBtn].forEach(function(t){e?t.classList.remove("disabled"):t.classList.add("disabled")})}},{key:"clearDefaultText",value:function(){""==this.input.value&&(this.composition.innerText="")}},{key:"replaceDefaultText",value:function(t){"initial-input"!==t.target.id&&""==this.input.value&&(this.composition.innerText=this.defaultText)}},{key:"makeUnique",value:function(t){return[].concat(_toConsumableArray(new Set(t)))}},{key:"getRandomEl",value:function(t){return t[Math.floor(Math.random()*t.length)]}}]),t}();document.addEventListener("DOMContentLoaded",function(){MuseMachina=new App});