function _typeof2(t){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function i(s,o,r){function a(e,t){if(!o[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}n=o[e]={exports:{}},s[e][0].call(n.exports,function(t){return a(s[e][1][t]||t)},n,n.exports,i,s,o,r)}return o[e].exports}for(var u="function"==typeof require&&require,t=0;t<r.length;t++)a(r[t]);return a}({1:[function(t,v,e){!function(d){!function(){var g="Expected a function",n=NaN,i="[object Symbol]",s=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,a=/^0o[0-7]+$/i,u=parseInt,t="object"==_typeof2(d)&&d&&d.Object===Object&&d,e="object"==("undefined"==typeof self?"undefined":_typeof2(self))&&self&&self.Object===Object&&self,c=t||e||Function("return this")(),l=Object.prototype.toString,b=Math.max,k=Math.min,L=function(){return c.Date.now()};function h(i,n,t){var s,o,r,a,u,c,l=0,h=!1,f=!1,e=!0;if("function"!=typeof i)throw new TypeError(g);function d(t){var e=s,n=o;return s=o=void 0,l=t,a=i.apply(n,e)}function v(t){var e=t-c;return void 0===c||n<=e||e<0||f&&r<=t-l}function m(){var t,e=L();if(v(e))return p(e);u=setTimeout(m,(t=n-((e=e)-c),f?k(t,r-(e-l)):t))}function p(t){return u=void 0,e&&s?d(t):(s=o=void 0,a)}function y(){var t=L(),e=v(t);if(s=arguments,o=this,c=t,e){if(void 0===u)return l=t=c,u=setTimeout(m,n),h?d(t):a;if(f)return u=setTimeout(m,n),d(c)}return void 0===u&&(u=setTimeout(m,n)),a}return n=S(n)||0,E(t)&&(h=!!t.leading,f="maxWait"in t,r=f?b(S(t.maxWait)||0,n):r,e="trailing"in t?!!t.trailing:e),y.cancel=function(){void 0!==u&&clearTimeout(u),s=c=o=u=void(l=0)},y.flush=function(){return void 0===u?a:p(L())},y}function E(t){var e=_typeof2(t);return t&&("object"==e||"function"==e)}function f(t){return"symbol"==_typeof2(t)||!!(e=t)&&"object"==_typeof2(e)&&l.call(t)==i;var e}function S(t){if("number"==typeof t)return t;if(f(t))return n;if("string"!=typeof(t=E(t)?E(e="function"==typeof t.valueOf?t.valueOf():t)?e+"":e:t))return 0===t?t:+t;t=t.replace(s,"");var e=r.test(t);return e||a.test(t)?u(t.slice(2),e?2:8):o.test(t)?n:+t}v.exports=function(t,e,n){var i=!0,s=!0;if("function"!=typeof t)throw new TypeError(g);return E(n)&&(i="leading"in n?!!n.leading:i,s="trailing"in n?!!n.trailing:s),h(t,e,{leading:i,maxWait:e,trailing:s})}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){{var n;if(t)return"string"==typeof t?i(t,e):"Map"===(n="Object"===(n={}.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=s(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);n=n.call(t,e||"default");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==s(t)?t:t+""}(i.key),i)}}throttle=t("lodash.throttle");var a=function(){function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");this.saveSelectors(),this.saveListenerCallbacks(),this.addListeners(),this.dictionary=dictionary,this.dictionaryKeys=Object.keys(this.dictionary),this.defaultText=this.composition.innerText,this.firstWord=!0,this.dbInitialized=!1,this.museumLoaded=!1,this.poemsPerPage=20}return e=t,(n=[{key:"saveSelectors",value:function(){this.activePage=document.querySelector(".active-page"),this.activeNav=document.querySelector(".active-nav-item"),this.suggestionEls=document.getElementsByClassName("suggestion-field"),this.composition=document.getElementById("composition-field"),this.input=document.getElementById("initial-input"),this.startBtn=this.suggestionEls[1],this.restartBtn=document.getElementById("restart-btn"),this.backBtn=document.getElementById("back-btn"),this.saveBtn=document.getElementById("save-btn"),this.shareBtn=document.getElementById("share-btn"),this.fbBtn=document.getElementById("share-fb-btn"),this.twitterBtn=document.getElementById("share-twitter-btn"),this.shareBtns=document.getElementById("share-btns"),this.dbSaveBtn=document.getElementById("db-save-btn"),this.museumEntries=document.getElementById("museum-entries")}},{key:"saveListenerCallbacks",value:function(){var e=this;this.startCallback=function(){return e.start()},this.selectionCallback=function(t){return e.updateComposition(t)},this.museumScrollCallback=throttle(function(){return e.museumLoadMore()},1e3)}},{key:"addListeners",value:function(){this.overlayListener(),this.navListener(),this.activeListener(),this.inactiveListener(),this.typingListener(),this.startListener(!0),this.backspaceListener(),this.buttonListeners()}},{key:"overlayListener",value:function(){var t=this;document.querySelector(".save-poem-overlay").addEventListener("click",function(){return t.toggleSaveDialogue()})}},{key:"navListener",value:function(){var e=this;document.querySelectorAll(".nav-list-item").forEach(function(t){t.addEventListener("click",function(t){return e.clickNavItem(t)})})}},{key:"activeListener",value:function(){var t=this;this.input.addEventListener("click",function(){return t.clearDefaultText()})}},{key:"inactiveListener",value:function(){var e=this;window.addEventListener("click",function(t){return e.replaceDefaultText(t)})}},{key:"typingListener",value:function(){var e=this;this.input.addEventListener("input",function(t){return e.type(t)})}},{key:"startListener",value:function(t){t?this.startBtn.addEventListener("click",this.startCallback):this.startBtn.removeEventListener("click",this.startCallback)}},{key:"backspaceListener",value:function(){var e=this;window.addEventListener("keyup",function(t){8!==t.keyCode||e.firstWord||e.deleteLastWord()})}},{key:"selectionListener",value:function(t){var e=this;t?o(this.suggestionEls).forEach(function(t){t.addEventListener("click",e.selectionCallback)}):o(this.suggestionEls).forEach(function(t){t.removeEventListener("click",e.selectionCallback)})}},{key:"scrollListener",value:function(t){t?window.addEventListener("scroll",this.museumScrollCallback):window.removeEventListener("scroll",this.museumScrollCallback)}},{key:"buttonListeners",value:function(){var t=this;this.restartBtn.addEventListener("click",function(){return t.restartComposition()}),this.backBtn.addEventListener("click",function(){return t.deleteLastWord()}),this.saveBtn.addEventListener("click",function(){return t.toggleSaveDialogue()}),this.shareBtn.addEventListener("click",function(){return t.toggleShareButtons()}),this.fbBtn.addEventListener("click",function(){return t.shareToFB()}),this.twitterBtn.addEventListener("click",function(){return t.shareToTwitter()}),this.dbSaveBtn.addEventListener("click",function(){return t.savePoem()})}},{key:"clickNavItem",value:function(t){var t=t.currentTarget.dataset.page,e=document.getElementById(t);e!==this.activePage&&(this.museumLoaded||"museum-page"!==e.id||this.loadMuseum(),this.navigate(e),this.updateActiveNav(t))}},{key:"navigate",value:function(t){var e=this;this.activePage.classList.add("slide-out"),t.classList.add("slide-in"),setTimeout(function(){e.activePage.classList.remove("active-page"),e.activePage.classList.remove("slide-out"),t.classList.add("active-page"),t.classList.remove("slide-in"),e.activePage=t},300)}},{key:"updateActiveNav",value:function(t){t=document.querySelector("[data-page="+t);this.activeNav.classList.remove("active-nav-item"),t.classList.add("active-nav-item"),this.activeNav=t}},{key:"type",value:function(t){t=t.target.value;t=(t=t.split(" ")[0]).trim().toLowerCase(),this.composition.innerText=t,this.showStart(!!t.length)}},{key:"showStart",value:function(t){t?this.startBtn.classList.add("start-btn"):this.startBtn.classList.remove("start-btn")}},{key:"start",value:function(){this.showStart(!1),this.startListener(!1),this.selectionListener(!0),this.disableInput(),this.readInput()}},{key:"readInput",value:function(){var t=this.composition.innerText;this.showSuggestions(t),this.toggleButtonsState(!0)}},{key:"disableInput",value:function(){this.input.disabled=!0,this.firstWord=!1}},{key:"enableInput",value:function(){this.input.disabled=!1,this.input.value="",this.input.focus(),this.firstWord=!0}},{key:"updateComposition",value:function(t){t=t.target.innerText;t&&(this.addNextWord(t),this.showSuggestions(t))}},{key:"addNextWord",value:function(t){this.composition.innerText+=" "+t}},{key:"deleteLastWord",value:function(){var t=this.composition.innerText.split(" ");t.pop(),t.length?(this.composition.innerText=t.join(" "),this.refreshSuggestions()):this.restartComposition()}},{key:"getLastWord",value:function(){var t=this.composition.innerText.split(" ");return t[t.length-1]}},{key:"restartComposition",value:function(){this.composition.innerText="",this.enableInput(),this.clearSuggestions(),this.toggleButtonsState(!1),this.startListener(!0)}},{key:"showSuggestions",value:function(t){t=this.getSuggestions(t);this.returnSuggestions(t)}},{key:"getSuggestions",value:function(t){var e=this.dictionary[t],t=this.makeUnique(e),n=[];if(t.length<3)var i=3-t.length,i=this.getDefaults(i),n=[].concat(o(t),o(i));else if(3===t.length)n=t;else for(;n.length<3;){var s=this.getRandomEl(e);n.includes(s)||n.push(s)}return n}},{key:"getDefaults",value:function(t){return this.getSuggestions("the").slice(0,t)}},{key:"returnSuggestions",value:function(t){for(var e=0;e<3;e++)this.suggestionEls[e].innerText=t[e]}},{key:"refreshSuggestions",value:function(){var t=this.getLastWord();this.showSuggestions(t)}},{key:"clearSuggestions",value:function(){o(this.suggestionEls).forEach(function(t){t.innerText=""})}},{key:"loadMuseum",value:function(){this.dbInitialized||this.initializeFirebase(),this.fetchPoems(!0),this.scrollListener(!0),this.museumLoaded=!0}},{key:"initializeFirebase",value:function(){this.db=firebase.database(),this.poemsDB=this.db.ref("poems"),this.dbInitialized=!0}},{key:"fetchPoems",value:function(e){var n=this;(e?this.poemsDB:this.poemsDB.orderByKey().endAt(this.lastPoem)).limitToLast(this.poemsPerPage+1).on("value",function(t){n.processPoems(t.val(),e)},function(t){console.log("The read failed: ",t)})}},{key:"processPoems",value:function(t){var e=Object.keys(t),n=e.length<this.poemsPerPage,t=n?Object.values(t):Object.values(t).slice(1);n&&this.scrollListener(!1),this.lastPoem=e[0],this.displayPoems(t)}},{key:"displayPoems",value:function(t){var e=this;(t=t.reverse()).forEach(function(t){return e.displayPoem(t)})}},{key:"displayPoem",value:function(t){t='\n            <div class="museum-entry">\n                <p class="poem-text">'.concat(t.poem,'</p>\n                <p class="poem-composer">').concat(t.user,"</p>\n            </div>\n        ");this.museumEntries.innerHTML+=t}},{key:"museumLoadMore",value:function(){"museum-page"===this.activePage.id&&this.museumEntries.getBoundingClientRect().bottom-window.innerHeight<=window.innerHeight&&this.fetchPoems()}},{key:"savePoem",value:function(){var t=this.composition.innerText,e=document.getElementById("penname").value;this.dbInitialized||this.initializeFirebase(),this.savePoemToDB(t,e),this.toggleSaveDialogue()}},{key:"savePoemToDB",value:function(t,e){var n={};n[this.poemsDB.push().key]={poem:t,user:e},this.poemsDB.update(n)}},{key:"toggleButtonsState",value:function(e){[this.restartBtn,this.backBtn,this.saveBtn,this.shareBtn].forEach(function(t){e?t.classList.remove("disabled"):t.classList.add("disabled")})}},{key:"toggleSaveDialogue",value:function(){document.body.classList.toggle("dialogue-open")}},{key:"toggleShareButtons",value:function(){this.shareBtns.classList.toggle("expanded")}},{key:"clearDefaultText",value:function(){""===this.input.value&&(this.composition.innerText="")}},{key:"replaceDefaultText",value:function(t){"initial-input"!==t.target.id&&""===this.input.value&&(this.composition.innerText=this.defaultText)}},{key:"shareToFB",value:function(){var t=encodeURI(this.composition.innerText);window.open("https://www.facebook.com/dialog/share?app_id=344145906430055&display=popup&href=https%3A%2F%2Fmusemachina.com&quote=".concat(t),"_blank"),this.toggleShareButtons()}},{key:"shareToTwitter",value:function(){var t='"'.concat(this.composition.innerText,'" | composing computer poetry at https://musemachina.com'),t=encodeURI(t);window.open("https://twitter.com/intent/tweet?text=".concat(t),"_blank"),this.toggleShareButtons()}},{key:"makeUnique",value:function(t){return o(new Set(t))}},{key:"getRandomEl",value:function(t){return t[Math.floor(Math.random()*t.length)]}}])&&r(e.prototype,n),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,i}();document.addEventListener("DOMContentLoaded",function(){a=new a})},{"lodash.throttle":1}]},{},[2]);